<div class="product-details-container">
  <div class="header-actions">
    <button mat-button (click)="goBack()" class="back-button">
      <mat-icon>arrow_back</mat-icon> Back to list
    </button>

    <button
      mat-raised-button
      color="primary"
      (click)="openEditModal()"
      *ngIf="!loading && !error && product"
    >
      <mat-icon>edit</mat-icon> Edit Product
    </button>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
  </div>

  <div *ngIf="error" class="error-container">
    <h2>Oops! Something went wrong.</h2>
    <p>We couldn't load the product information.</p>
    <button mat-raised-button color="primary" (click)="goBack()">
      Back to product list
    </button>
  </div>

  <div *ngIf="!loading && !error && product" class="product-content">
    <div class="product-header">
      <h1>{{ product.title }}</h1>
      <div class="product-brand-category">
        <mat-chip>{{ product.brand }}</mat-chip>
        <mat-chip>{{ product.category }}</mat-chip>
      </div>
    </div>

    <div class="product-main">
      <div class="product-gallery">
        <div class="main-image">
          <img [src]="product.images[activeImageIndex]" [alt]="product.title" />
        </div>
        <div class="thumbnails">
          <img
            *ngFor="let image of product.images; let i = index"
            [src]="image"
            [alt]="'Image ' + (i + 1)"
            [class.active]="i === activeImageIndex"
            (click)="setActiveImage(i)"
          />
        </div>
      </div>

      <div class="product-info">
        <mat-card>
          <mat-card-content>
            <div class="price-section">
              <h2 class="price">
                {{
                  getConvertedPrice(product.price)
                    | currencyFormat : getCurrencySymbol()
                }}
              </h2>
              <div *ngIf="product.discountPercentage > 0" class="discount">
                <span class="discount-badge"
                  >-{{ product.discountPercentage }}%</span
                >
                <span class="original-price">{{
                  getConvertedPrice(
                    product.price / (1 - product.discountPercentage / 100)
                  ) | currencyFormat : getCurrencySymbol()
                }}</span>
              </div>
            </div>

            <div class="stock-rating">
              <div class="stock" [class.low-stock]="product.stock < 10">
                <mat-icon>inventory_2</mat-icon>
                <span>{{ product.stock }} in stock</span>
              </div>
              <div class="rating">
                <mat-icon *ngFor="let star of [1, 2, 3, 4, 5]">
                  {{
                    star <= product.rating
                      ? "star"
                      : star - 0.5 <= product.rating
                      ? "star_half"
                      : "star_border"
                  }}
                </mat-icon>
                <span>{{ product.rating }}/5</span>
              </div>
            </div>

            <mat-divider></mat-divider>

            <div class="description">
              <h3>Description</h3>
              <p>{{ product.description }}</p>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <div class="product-details">
      <mat-tab-group>
        <mat-tab label="Specifications">
          <div class="specs-table">
            <div class="spec-row">
              <div class="spec-label">Brand</div>
              <div class="spec-value">{{ product.brand }}</div>
            </div>
            <div class="spec-row">
              <div class="spec-label">Category</div>
              <div class="spec-value">{{ product.category }}</div>
            </div>
            <div class="spec-row">
              <div class="spec-label">Rating</div>
              <div class="spec-value">{{ product.rating }}/5</div>
            </div>
            <div class="spec-row">
              <div class="spec-label">Stock</div>
              <div class="spec-value">{{ product.stock }} units</div>
            </div>
            <div class="spec-row">
              <div class="spec-label">ID</div>
              <div class="spec-value">{{ product.id }}</div>
            </div>
          </div>
        </mat-tab>
        <mat-tab label="Comments">
          <p class="tab-content">Comments section under development...</p>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>
